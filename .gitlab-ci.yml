stages:
  - deploy
  - integration

## =============================================================================
## == DEPLOY ===================================================================
## =============================================================================

deploy-docker:
  stage: deploy
  image: 
    name: ${CI_REGISTRY}/general/docker-images/docker-builder:latest
  script:
    - TAGS=git-${CI_COMMIT_SHORT_SHA} NAME=foxdec DOCKERFILE=ci/Dockerfile /build.sh

verify-docker:
  stage: integration
  image:
    name: ${CI_REGISTRY}/vatech/tools/foxdec/foxdec:git-${CI_COMMIT_SHORT_SHA}
  script:
    - echo "$PATH"
    - ls -l /app
    - ellf_cfi_patch --help
    - foxdec --help
    - disasm --help

## =============================================================================
## == INTEGRATION ==============================================================
## =============================================================================

.integration_template:
  stage: integration
  needs: [deploy-docker]
  trigger:
    branch: ellf-2

trigger-analyze-image:
  extends: .integration_template
  trigger:
    project: vatech/integration-2/analyze-image

trigger-lamartine:
  extends: .integration_template
  trigger:
    project: vatech/integration-2/lamartine

trigger-openalpr:
  extends: .integration_template
  trigger:
    project: vatech/integration-2/openalpr

